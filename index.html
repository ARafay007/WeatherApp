<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Check My Weather</title>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      header {
        text-align: center;
        background-color: blueviolet;
        height: 10vh;
      }

      .parent_section {
        display: flex;
        background-color: brown;
        padding: 5px;
        height: 90vh;
      }

      .search_section {
        display: flex;
        width: 40%;
        margin-right: 5px;
      }

      .weather_section {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 60%;
      }

      .search_section,
      .weather_section {
        height: 100%;
        background-color: white;
      }

      .country_section {
        /* display: grid; */
        height: auto;
        margin: 5px;
        /* grid-template-rows: 5% 5% auto; */
      }

      .searchCountries,
      .searchCity {
        width: 250px;
        height: 30px;
        border: 1px solid black;
        border-radius: 3px;
        outline: none;
        padding: 0 5px;
      }

      .searchCountries:focus,
      .searchCountries:hover,
      .searchCity:focus,
      .searchCity:hover {
        border: 1px solid goldenrod;
      }

      .showCountryDropDown {
        max-height: 300px;
        min-height: 30px;
        overflow-y: auto;
        width: 250px;
        border-radius: 3px;
        background-color: aqua;
        transition: height 0.5s;
      }

      .countryLI,
      .cityLI {
        border-bottom: 1px solid black;
        padding: 5px 10px;
      }

      .countryLI:hover,
      .cityLI:hover {
        background-color: rgba(27, 27, 27, 0.7);
      }

      .hideCountryList {
        height: 0px;
        transition: height 0.5s;
      }

      .hideCountryList,
      .hideCityList,
      .hideLI {
        display: none;
      }

      .weather_section-gifDivHolder {
        background-color: burlywood;
        width: 100%;
        height: 80%;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Check My Weather</h1>
    </header>
    <section class="parent_section">
      <section class="search_section">
        <section class="country_section">
          <div>
            <label>Select Country</label>
          </div>
          <input
            type="text"
            placeholder="Select country"
            class="searchCountries"
          />
          <div id="countryDropDown" class="hideCountryList"></div>
        </section>
        <section class="country_section">
          <label>Select City</label>
          <input type="text" placeholder="Select city" class="searchCity" />
          <div id="cityDropDown" class="hideCityList">
            <p class="cityLI" aria-disabled="true">Please select country</p>
          </div>
        </section>
      </section>
      <section class="weather_section">
        <div class="weather_section-gifDivHolder">
          <div></div>
          <div>
            <div></div>
            <div></div>
            <div></div>
          </div>
        </div>
      </section>
    </section>
  </body>

  <script>
    // const weatherAPI = `https://api.weatherstack.com/current?access_key=YOUR_ACCESS_KEY&query=New York`;
    // const weatherAPI_key = "b51ed73230cd6ab71fb0d6128a60695c";
    // let countriesAPI = "https://restcountries.com/v3.1/all";
    // const citiesName = "https://countriesnow.space/api/v0.1/countries/cities";
    const countryTextbox = document.querySelector(".searchCountries");
    const countryDropDown = document.querySelector("#countryDropDown");
    const countriesName = document.querySelectorAll(".countryLI");

    const cityTextbox = document.querySelector(".searchCity");
    const cityDropDown = document.querySelector("#cityDropDown");
    const citiesName = document.querySelectorAll("cityLI");
    let countriesList, cityList, countryName, cityName;

    const fetchCountries = async () => {
      const resp = await fetch("https://restcountries.com/v3.1/all");
      const data = await resp.json();
      countriesList = data.map((el) => el.name.common);

      countriesList.forEach((country) => {
        const paragraph = `<p class='countryLI'>${country}</p>`;
        countryDropDown.insertAdjacentHTML("afterbegin", paragraph);
      });
    };

    fetchCountries();

    countryTextbox.addEventListener("click", () => {
      countryDropDown.className = "showCountryDropDown";
      countriesName.forEach((el) => {
        el.classList.remove("hideLI");
      });
    });

    cityTextbox.addEventListener("click", () => {
      cityDropDown.className = "showCountryDropDown";
      citiesName.forEach((el) => {
        el.classList.remove("hideLI");
      });
    });

    countryDropDown.addEventListener("click", async (event) => {
      countryName = event.target.innerHTML;
      countryTextbox.value = countryName;

      const resp = await fetch(
        `https://countriesnow.space/api/v0.1/countries/cities`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ country: countryName })
        }
      );
      const { data } = await resp.json();
      cityList = data;

      while (cityDropDown.firstChild) {
        cityDropDown.removeChild(cityDropDown.firstChild);
      }

      data?.forEach((city) => {
        cityDropDown.insertAdjacentHTML(
          "afterbegin",
          `<p class='cityLI'>${city}</p>`
        );
      });
    });

    cityDropDown.addEventListener("click", async (event) => {
      cityName = event.target.innerHTML;
      cityTextbox.value = cityName;

      const resp = await fetch(
        `http://api.weatherstack.com/current?access_key=b51ed73230cd6ab71fb0d6128a60695c&query=${cityName},${countryName}`
      );
      const data = await resp.json();
      console.log(data);
    });

    countryDropDown.addEventListener("mouseleave", () => {
      countryDropDown.className = "hideCountryList";
      countriesName.forEach((el) => (el.className = "hideLI"));
    });

    cityDropDown.addEventListener("mouseleave", () => {
      cityDropDown.className = "hideCityList";
      citiesName.forEach((el) => (el.classname = "hideLI"));
    });

    countryTextbox.addEventListener("keyup", (event) => {
      while (countryDropDown.firstChild) {
        countryDropDown.removeChild(countryDropDown.firstChild);
      }

      countriesList.forEach((country) => {
        if (country.toLowerCase().includes(event.target.value.toLowerCase())) {
          countryDropDown.insertAdjacentHTML(
            "afterbegin",
            `<p class='countryLI'>${country}</p>`
          );
        }
      });
    });

    cityTextbox.addEventListener("keyup", (event) => {
      while (cityDropDown.firstChild) {
        cityDropDown.removeChild(cityDropDown.firstChild);
      }

      cityList?.forEach((city) => {
        if (city.toLowerCase().includes(event.target.value.toLowerCase())) {
          cityDropDown.insertAdjacentHTML(
            "afterbegin",
            `<p class='cityLI'>${city}</p>`
          );
        }
      });
    });
  </script>
</html>
